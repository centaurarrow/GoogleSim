<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html, body {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
      #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
      #panel {
        position: absolute;
        top: 5px;
        left: 30%;
        margin-left: -180px;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
      }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA8yIIQagPjfQkOJ9a4XE14z6g4EZ62dNY&sensor=true">
    </script>
    <script type="text/javascript">
     var directionsDisplay;
     var directionsService;
     var stepDisplay; 
     var markerArray = []; 
     var map;
     var myRoute;
     var directionResult; 
     function initialize(){
    	//create directionsDisplay
    	directionsService  = new google.maps.DirectionsService();
    	
    	var manhattan = new google.maps.LatLng(40.7711329, -73.9741874);
    	//create the mapOptions object.
    	var mapOptions = {
    		center:manhattan,
    		zoom : 13
   		};
    	
    	//create the map object
    	map = new google.maps.Map(document.getElementById("map-canvas"),mapOptions);
    	
    	var rendererOptions = {
    			map:map
    	};
    	
    	directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
    	
 		//
 		stepDisplay = new google.maps.InfoWindow();
 		directionsDisplay.setPanel(document.getElementById("directionsPanel"));
 		
      }
      
      function calcRoute(){
    	  // clear out all the previous things. 
    	  for(i=0;i< markerArray.length;i++){
    		  markerArray[i].setMap(null);
    	  }
    	  
    	  var start = document.getElementById('start').value;
    	  var end = document.getElementById('end').value;
    	  // creating the directionsRequest object
    	  var request = {
			  origin:start,
			  destination:end,
			  travelMode:google.maps.TravelMode.WALKING,
			  provideRouteAlternatives : true,
			  durationInTraffic:false
    	  };
    	  
    	  directionsService.route(request,function(response,status){
    		  if(status == google.maps.DirectionsStatus.OK){
  //   			  var warnings = document.getElementById('warnings_panel');
  //  			  warnings.innerHTML = '<b>'+response.routes[0].warnings + '</b>';
    			  console.log(response);
    			  directionsDisplay.setDirections(response);
    			  showSteps(response);
    		  }
    	  });
    	  
    	  document.getElementById("directionsPanel").style.display="block";
    	  document.getElementById("map-canvas").style.width="70%";
      }
      
      function showSteps(directionResults){
    	  myRoute = directionResults.routes[0].legs[0];
    	  directionResult = directionResults;
    	  for(var i=1; i < myRoute.steps.length;i++){
    		  var marker = new google.maps.Marker({
    			  position : myRoute.steps[i].start_location,
    			  map:map
    		  });
    		  attachInstructionText(marker,myRoute.steps[i].instructions);
    		  markerArray[i] = marker;
    	  }
      }
      
      function starttrip(){
    	  var overview_path = directionResult.routes[0];
    	  var distance = directionResult.routes[0].legs[0].distance.value;
    	  var duration = directionResult.routes[0].legs[0].duration.value;
    	  var image = {
    			    url: '../images/ferrari.png',
    			    // This marker is 20 pixels wide by 32 pixels tall.
    			    size: new google.maps.Size(32, 32),
    			  };
    	  
    	  var marker = new google.maps.Marker({
    		  position : myRoute.steps[0].start_location,
    		  map:map,
    		  icon: {
    		      path: google.maps.SymbolPath.CIRCLE,
    		      scale: 10
    		    }
    	  });
    	  
    	//  var time = calcTime(distance,duration,overview_path.overview_path.length);
    	  for(var i=0;i<overview_path.overview_path.length;i++){
    		 (function(i){
    			 var ltn = new google.maps.LatLng(overview_path.overview_path[i].k, overview_path.overview_path[i].A);
    			 setTimeout(function(){ 
    			 marker.setPosition(ltn);	 
    		//	alert(overview_path.overview_path[i].k +'   ' + overview_path.overview_path[i].A);
				},i*2550);
    		 })(i);
    		 
    	  }
    //	  alert(overview_path.overview_path.length);
      }
      
      function calcTime(distance,duration,numberOfSteps){
    	  
    	  var avg = (duration/numberOfSteps)*100;
    	  return avg;
      }
      
      function attachInstructionText(marker, text) {
    	  google.maps.event.addListener(marker, 'click', function() {
    	    stepDisplay.setContent(text);
    	    stepDisplay.open(map, marker);
    	  });
    	}
  	//create an event to load 
  	google.maps.event.addDomListener(window,'load',initialize);

  	</script>
  </head>
   <body>
    <div id="panel">
	    <b>Start: </b>
		    <select id="start">
		      <option value="penn station, new york, ny">Penn Station</option>
		      <option value="grand central station, new york, ny">Grand Central Station</option>
		      <option value="625 8th Avenue, New York, NY, 10018">Port Authority Bus Terminal</option>
		      <option value="staten island ferry terminal, new york, ny">Staten Island Ferry Terminal</option>
		      <option value="101 E 125th Street, New York, NY">Harlem - 125th St Station</option>
		    </select>
		    <b>End: </b>
		    <select id="end" onchange="calcRoute();">
		      <option value="260 Broadway New York NY 10007">City Hall</option>
		      <option value="W 49th St & 5th Ave, New York, NY 10020">Rockefeller Center</option>
		      <option value="moma, New York, NY">MOMA</option>
		      <option value="350 5th Ave, New York, NY, 10118">Empire State Building</option>
		      <option value="253 West 125th Street, New York, NY">Apollo Theater</option>
		      <option value="1 Wall St, New York, NY">Wall St</option>
		    </select>
		
    </div>
    <div id="map-canvas" style="float:left;width:100%; height:100%"></div>
    &nbsp;
    <div id="directionsPanel" style="display:none;float:right;width:30%;height:100%">
    	<div id="buttons">
    		<input type="button" value="start trip" name="starttrip" onclick="starttrip()"/>
    		<input type="button" value="pause trip" name="pausetrip"/>
    		<input type="button" value="end trip" name="endtrip"/>
    	</div>
    </div>
    <div id="Latitudes">
    	
    </div>
  </body>
</html>